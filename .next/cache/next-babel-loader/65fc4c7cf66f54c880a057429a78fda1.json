{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\nimport React, { useEffect, useState } from \"react\";\nimport OrderSummary from \"../checkout/OrderSummary\";\nimport Link from \"next/link\";\nimport ShippingSummary from \"../checkout/ShippingSummary\";\nimport { decryptData, clearData, encryptData } from \"../../store/actions/cartActions\";\nimport { decryptInfoData, encryptString } from \"../../store/actions/infoActions\";\nimport axios from \"axios\";\nimport Router from \"next/router\";\nimport Paypal from \"./Paypal\";\nimport cookie from \"js-cookie\";\nimport { formatDate } from \"../../helpers/function\";\nimport { Slide, toast, ToastContainer } from \"react-toastify\";\nimport { useDispatch } from \"react-redux\";\nvar host = process.env.API_URL;\n\nfunction PaymentMethods() {\n  var _this = this;\n\n  var dispatch = useDispatch();\n\n  var _useState = useState(\"\"),\n      selectedPayment = _useState[0],\n      setselectedPayment = _useState[1];\n\n  var _useState2 = useState(false),\n      isCampaign = _useState2[0],\n      setisCampaign = _useState2[1];\n\n  var _useState3 = useState(false),\n      isLoading = _useState3[0],\n      setisLoading = _useState3[1];\n\n  var _useState4 = useState(false),\n      isCodOn = _useState4[0],\n      setisCodOn = _useState4[1];\n\n  useEffect(function () {\n    var encryptedInfoData = localStorage.getItem(process.env.INFO_COOKIE);\n    var stateSchema = decryptInfoData(encryptedInfoData);\n\n    if (stateSchema.shipping_city.value.toLowerCase().includes(\"makati\") || stateSchema.shipping_address.value.toLowerCase().includes(\"makati\") || [1226, 1233, 1209, 1214, 1217, 1221, 1222, 1219, 1220, 1202, 1201, 1228, 1212, 1211, 1206, 1204, 1229, 1232, 1224, 1200, 1207, 1235, 1231, 1218, 1213, 1230, 1210, 1216, 1215, 1227, 1203, 1234, 1223, 1205, 1225, 1208].includes(parseInt(stateSchema.shipping_zip.value))) {\n      setisCodOn(true);\n    }\n\n    var decryptedData = decryptInfoData();\n\n    if (decryptedData) {\n      if (decryptedData.delivery_date.value == \"2023-02-14\") {\n        setisCampaign(true);\n      }\n    } // toast.error(err.response.data[0].message);\n    // console.log(, \"HEYYYY\");\n\n  }, []);\n\n  var handleChange = function handleChange(value) {\n    setselectedPayment(value);\n  };\n\n  var fetchUser = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(token) {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return axios.get(\"\".concat(host, \"/api/user/user/details\"), {\n                headers: {\n                  Authorization: token\n                }\n              });\n\n            case 3:\n              res = _context.sent;\n\n              if (!res.data.userDetails) {\n                _context.next = 8;\n                break;\n              }\n\n              return _context.abrupt(\"return\", res.data.userDetails[\"id\"]);\n\n            case 8:\n              return _context.abrupt(\"return\", 0);\n\n            case 9:\n              _context.next = 16;\n              break;\n\n            case 11:\n              _context.prev = 11;\n              _context.t0 = _context[\"catch\"](0);\n              localStorage.removeItem(\"token\");\n\n              _this.props.history.push(\"/login\");\n\n              toast.error(\"Your token is invalid or expired.\");\n\n            case 16:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 11]]);\n    }));\n\n    return function fetchUser(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var handleChangePrice = function handleChangePrice(products) {\n    var cartStorage = localStorage.getItem(process.env.CART_COOKIE);\n    var cartArray = decryptData(cartStorage);\n\n    var _loop = function _loop(i) {\n      var el = products[i];\n      index = cartArray.findIndex(function (item) {\n        return item.id === el.productId;\n      });\n\n      if (index > -1) {\n        cartArray[index][\"campaign_price\"] = el.campaign_price;\n        cartArray[index][\"discount_price\"] = el.discount_price;\n      }\n\n      var encryptedData = encryptData(JSON.stringify(cartArray));\n      localStorage.setItem(process.env.CART_COOKIE, encryptedData);\n      dispatch(function () {\n        return {\n          type: \"UPDATE_CART\"\n        };\n      }());\n    };\n\n    for (var i = 0; i < products.length; i++) {\n      var index;\n\n      _loop(i);\n    }\n  };\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(paymentMethod) {\n      var userId, token, encryptedData, encryptedInfoData, cart, stateSchema, orderItems, i, obj, order, res, _encryptedData, sendEmailRes;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              userId = 0;\n              token = cookie.get(\"_wus_BJK\");\n\n              if (!token) {\n                _context2.next = 11;\n                break;\n              }\n\n              _context2.prev = 3;\n              _context2.next = 6;\n              return fetchUser(token);\n\n            case 6:\n              userId = _context2.sent;\n              _context2.next = 11;\n              break;\n\n            case 9:\n              _context2.prev = 9;\n              _context2.t0 = _context2[\"catch\"](3);\n\n            case 11:\n              setisLoading(true);\n              encryptedData = localStorage.getItem(process.env.CART_COOKIE);\n              encryptedInfoData = localStorage.getItem(process.env.INFO_COOKIE);\n              cart = decryptData(encryptedData);\n              stateSchema = decryptInfoData(encryptedInfoData);\n              orderItems = [];\n\n              for (i = 0; i < cart.length; i++) {\n                obj = null;\n\n                if (isCampaign) {\n                  obj = {\n                    productId: cart[i].id,\n                    name: cart[i].name,\n                    quantity: cart[i].quantity,\n                    itemPrice: cart[i].campaign_price\n                  };\n                } else {\n                  obj = {\n                    productId: cart[i].id,\n                    name: cart[i].name,\n                    quantity: cart[i].quantity,\n                    itemPrice: cart[i].discount_price\n                  };\n                }\n\n                orderItems.push(obj);\n              }\n\n              order = {\n                orderItems: orderItems,\n                userId: userId,\n                shippingFirstName: stateSchema.shipping_firstName.value,\n                shippingLastName: stateSchema.shipping_lastName.value,\n                shippingPhone: stateSchema.shipping_phone.value,\n                shippingAddress: stateSchema.shipping_address.value,\n                shippingCity: stateSchema.shipping_city.value,\n                shippingProvince: \"Metro Manila\",\n                shippingZip: stateSchema.shipping_zip.value,\n                deliveryInstructions: stateSchema.note.value,\n                message: stateSchema.message.value,\n                billingFirstName: stateSchema.billing_firstName.value,\n                billingLastName: stateSchema.billing_lastName.value,\n                billingPhone: stateSchema.billing_phone.value,\n                billingEmail: stateSchema.billing_email.value,\n                deliveryDate: stateSchema.delivery_date.value,\n                deliveryTime: stateSchema.delivery_time.value,\n                paymentMethod: paymentMethod,\n                isCampaign: isCampaign\n              };\n              _context2.prev = 19;\n              _context2.next = 22;\n              return axios.post(\"\".concat(host, \"/api/user/order\"), order);\n\n            case 22:\n              res = _context2.sent;\n\n              if (!res) {\n                _context2.next = 29;\n                break;\n              }\n\n              _encryptedData = encryptString(res.data.order_name); // return console.log(encryptedData, encryptedData);\n\n              _context2.next = 27;\n              return axios.post(\"\".concat(host, \"/api/user/order/sendEmail\"), {\n                billingEmail: order.billingEmail,\n                billingFirstName: order.billingFirstName,\n                orderName: res.data.order_name,\n                cryptoStr: _encryptedData,\n                orderItems: orderItems,\n                paymentMethod: paymentMethod,\n                deliveryDate: formatDate(stateSchema.delivery_date.value)\n              });\n\n            case 27:\n              sendEmailRes = _context2.sent;\n\n              if (sendEmailRes) {\n                clearData();\n                Router.push(\"/thankyou/\".concat(_encryptedData));\n              }\n\n            case 29:\n              _context2.next = 44;\n              break;\n\n            case 31:\n              _context2.prev = 31;\n              _context2.t1 = _context2[\"catch\"](19);\n              setisLoading(false);\n              console.log(_context2.t1.response.data);\n              console.log(_context2.t1.response.data[0].message);\n\n              if (!_context2.t1.response) {\n                _context2.next = 43;\n                break;\n              }\n\n              if (!_context2.t1.response.data) {\n                _context2.next = 41;\n                break;\n              }\n\n              if (!_context2.t1.response.data[0]) {\n                _context2.next = 41;\n                break;\n              }\n\n              if (_context2.t1.response.data[0].updatedOrderItems) {\n                handleChangePrice(_context2.t1.response.data[0].updatedOrderItems);\n              }\n\n              return _context2.abrupt(\"return\", toast.error(_context2.t1.response.data[0].message));\n\n            case 41:\n              _context2.next = 44;\n              break;\n\n            case 43:\n              toast.error(\"Something went wrong, Please try again or contact us.\");\n\n            case 44:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[3, 9], [19, 31]]);\n    }));\n\n    return function handleSubmit(_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(\"div\", {\n    className: \"pt-40\"\n  }, __jsx(ToastContainer, {\n    transition: Slide\n  }), __jsx(\"div\", {\n    className: \"row\",\n    style: {\n      marginLeft: \"0px\",\n      marginRight: \"0px\"\n    }\n  }, __jsx(\"div\", {\n    className: \"col-lg-5 col-md-5\"\n  }, __jsx(\"div\", null, __jsx(\"div\", {\n    className: \"d-flex\"\n  }, __jsx(\"h5\", null, \"User Details\"), __jsx(Link, {\n    href: \"/checkout\"\n  }, __jsx(\"a\", {\n    className: \"ml-auto btn btn-link text-danger\"\n  }, \"Edit\"))), __jsx(ShippingSummary, null)), __jsx(\"div\", null, __jsx(\"div\", {\n    className: \"d-flex\"\n  }, __jsx(\"h5\", null, \"Order Details\"), __jsx(Link, {\n    href: \"/cart\"\n  }, __jsx(\"a\", {\n    className: \"ml-auto btn btn-link text-danger\"\n  }, \"Edit\"))), __jsx(OrderSummary, null))), __jsx(\"div\", {\n    className: \"col-lg-7 col-md-7\"\n  }, __jsx(\"h5\", {\n    className: \"text-center\"\n  }, \"Select Payment Method\"), __jsx(\"div\", {\n    className: \"order-details\"\n  }, __jsx(\"div\", {\n    className: \"payment-method\",\n    style: {\n      paddingTop: 0,\n      marginTop: \"20px\",\n      marginLeft: \"0.5rem\",\n      marginRight: \"0.5rem\"\n    }\n  }, __jsx(\"div\", null, __jsx(\"p\", null, __jsx(\"input\", {\n    type: \"radio\",\n    id: \"direct-bank-transfer\",\n    name: \"radio-button\",\n    onChange: function onChange() {\n      return handleChange(\"bank\");\n    }\n  }), __jsx(\"label\", {\n    htmlFor: \"direct-bank-transfer\"\n  }, \"Direct Bank Transfer\"), selectedPayment == \"bank\" ? __jsx(React.Fragment, null, __jsx(\"hr\", null), __jsx(\"img\", {\n    src: require(\"../../images/logos/banks2.jpg\"),\n    alt: \"image\",\n    height: \"150\"\n  }), __jsx(\"p\", {\n    style: {\n      paddingTop: \"20px\"\n    }\n  }, \"Once the order is completed, you can settle the amount into our BPI account (via deposit or bank transfer)\"), __jsx(\"div\", null, __jsx(\"div\", {\n    className: \"d-flex justify-content-between\",\n    style: {\n      maxWidth: \"300px\"\n    }\n  }, __jsx(\"h6\", null, \"Bank:\"), __jsx(\"h6\", null, \"BPI\")), __jsx(\"div\", {\n    className: \"d-flex justify-content-between\",\n    style: {\n      maxWidth: \"300px\"\n    }\n  }, __jsx(\"h6\", null, \"Account Name:\"), __jsx(\"h6\", null, \"I-Wheels\")), __jsx(\"div\", {\n    className: \"d-flex justify-content-between\",\n    style: {\n      maxWidth: \"300px\"\n    }\n  }, __jsx(\"h6\", null, \"Account Number:\"), __jsx(\"h6\", null, \"3039022566\"))), __jsx(\"p\", {\n    style: {\n      color: \"red\",\n      paddingTop: \"20px\"\n    }\n  }, __jsx(\"b\", null, \"Note:\"), \" Please send proof of payment (screenshot, printscreen) to\", \" \", __jsx(\"span\", {\n    style: {\n      color: \"#33bd33\"\n    }\n  }, \"i-Wheels26@gmail.com\"), \" \", \"or send a message to our\", \" \", __jsx(\"a\", {\n    className: \"d-inline\",\n    href: \"https://www.facebook.com/i-Wheelsph-127061742122440/\"\n  }, \"Facebook Page\"), \".\"), __jsx(\"br\", null), __jsx(\"br\", null), !isLoading ? __jsx(\"button\", {\n    onClick: function onClick() {\n      return handleSubmit(\"Bank - BPI\");\n    },\n    className: \"btn btn-light mb-3\"\n  }, \"Confirm Order\") : __jsx(\"div\", {\n    className: \"lds-ring\"\n  }, __jsx(\"div\", null), __jsx(\"div\", null), __jsx(\"div\", null), __jsx(\"div\", null)), __jsx(\"hr\", null)) : null)), __jsx(\"div\", null, __jsx(\"p\", null, __jsx(\"input\", {\n    type: \"radio\",\n    id: \"cash-on-delivery\",\n    name: \"radio-button\",\n    onChange: function onChange() {\n      return handleChange(\"cod\");\n    }\n  }), __jsx(\"label\", {\n    htmlFor: \"cash-on-delivery\"\n  }, \"Cash on Delivery\"), selectedPayment == \"cod\" ? __jsx(React.Fragment, null, __jsx(\"hr\", null), __jsx(\"img\", {\n    src: require(\"../../images/logos/cod.jpg\"),\n    alt: \"image\",\n    height: \"100\"\n  }), __jsx(\"p\", {\n    style: {\n      paddingTop: \"10px\"\n    }\n  }, \"When using our Cash on Delivery service, payment is given to our delivery rider upon receipt of item.\"), __jsx(\"br\", null), !isLoading ? __jsx(\"button\", {\n    onClick: function onClick() {\n      return handleSubmit(\"COD\");\n    },\n    className: \"btn btn-light mb-3\"\n  }, \"Confirm Order\") : __jsx(\"div\", {\n    className: \"lds-ring\"\n  }, __jsx(\"div\", null), __jsx(\"div\", null), __jsx(\"div\", null), __jsx(\"div\", null)), __jsx(\"hr\", null)) : null)), __jsx(\"div\", null, __jsx(\"p\", null, __jsx(\"input\", {\n    type: \"radio\",\n    id: \"gcash\",\n    name: \"radio-button\",\n    onChange: function onChange() {\n      return handleChange(\"gcash\");\n    }\n  }), __jsx(\"label\", {\n    htmlFor: \"gcash\"\n  }, \"GCash\"), selectedPayment == \"gcash\" ? __jsx(React.Fragment, null, __jsx(\"hr\", null), __jsx(\"img\", {\n    src: require(\"../../images/logos/gcash.png\"),\n    alt: \"image\",\n    height: \"70\"\n  }), __jsx(\"p\", {\n    style: {\n      paddingTop: \"20px\"\n    }\n  }, \"Once the order is completed, you can settle the amount into our Gcash account (via deposit or bank transfer)\"), __jsx(\"div\", null, __jsx(\"div\", {\n    className: \"d-flex justify-content-between\",\n    style: {\n      maxWidth: \"300px\"\n    }\n  }, __jsx(\"h6\", null, \"E-Wallet:\"), __jsx(\"h6\", null, \"GCash\")), __jsx(\"div\", {\n    className: \"d-flex justify-content-between\",\n    style: {\n      maxWidth: \"300px\"\n    }\n  }, __jsx(\"h6\", null, \"Account Name:\"), __jsx(\"h6\", null, \"Marxs Joshua\")), __jsx(\"div\", {\n    className: \"d-flex justify-content-between\",\n    style: {\n      maxWidth: \"300px\"\n    }\n  }, __jsx(\"h6\", null, \"Mobile Number:\"), __jsx(\"h6\", null, \"09214430131\"))), __jsx(\"p\", {\n    style: {\n      color: \"red\",\n      paddingTop: \"20px\"\n    }\n  }, __jsx(\"b\", null, \"Note:\"), \" Please send proof of payment (screenshot, printscreen) to\", \" \", __jsx(\"span\", {\n    style: {\n      color: \"#33bd33\"\n    }\n  }, \"i-Wheels26@gmail.com\"), \" \", \"or send a message to our\", \" \", __jsx(\"a\", {\n    className: \"d-inline\",\n    href: \"https://www.facebook.com/i-Wheelsph-127061742122440/\"\n  }, \"Facebook Page\"), \".\"), __jsx(\"br\", null), !isLoading ? __jsx(\"button\", {\n    onClick: function onClick() {\n      return handleSubmit(\"GCash\");\n    },\n    className: \"btn btn-light mb-3\"\n  }, \"Confirm Order\") : __jsx(\"div\", {\n    className: \"lds-ring\"\n  }, __jsx(\"div\", null), __jsx(\"div\", null), __jsx(\"div\", null), __jsx(\"div\", null)), __jsx(\"hr\", null)) : null)), __jsx(\"div\", null, __jsx(\"p\", null, __jsx(\"input\", {\n    type: \"radio\",\n    id: \"paymaya\",\n    name: \"radio-button\",\n    onChange: function onChange() {\n      return handleChange(\"paymaya\");\n    }\n  }), __jsx(\"label\", {\n    htmlFor: \"paymaya\"\n  }, \"Paymaya\"), selectedPayment == \"paymaya\" ? __jsx(React.Fragment, null, __jsx(\"hr\", null), __jsx(\"img\", {\n    src: require(\"../../images/logos/paymaya.jpg\"),\n    alt: \"image\",\n    height: \"50\"\n  }), __jsx(\"p\", {\n    style: {\n      paddingTop: \"20px\"\n    }\n  }, \"Once the order is completed, you can settle the amount into our Paymaya account (via deposit or bank transfer)\"), __jsx(\"div\", null, __jsx(\"div\", {\n    className: \"d-flex justify-content-between\",\n    style: {\n      maxWidth: \"300px\"\n    }\n  }, __jsx(\"h6\", null, \"E-Wallet:\"), __jsx(\"h6\", null, \"Paymaya\")), __jsx(\"div\", {\n    className: \"d-flex justify-content-between\",\n    style: {\n      maxWidth: \"300px\"\n    }\n  }, __jsx(\"h6\", null, \"Account Name:\"), __jsx(\"h6\", null, \"I-Wheels\")), __jsx(\"div\", {\n    className: \"d-flex justify-content-between\",\n    style: {\n      maxWidth: \"300px\"\n    }\n  }, __jsx(\"h6\", null, \"Mobile Number:\"), __jsx(\"h6\", null, \"0916 509 1083\"))), __jsx(\"p\", {\n    style: {\n      color: \"red\",\n      paddingTop: \"20px\"\n    }\n  }, __jsx(\"b\", null, \"Note:\"), \" Please send proof of payment (screenshot, printscreen) to\", \" \", __jsx(\"span\", {\n    style: {\n      color: \"#33bd33\"\n    }\n  }, \"i-Wheels26@gmail.com\"), \" \", \"or send a message to our\", \" \", __jsx(\"a\", {\n    className: \"d-inline\",\n    href: \"https://www.facebook.com/i-Wheelsph-127061742122440/\"\n  }, \"Facebook Page\"), \".\"), __jsx(\"br\", null), !isLoading ? __jsx(\"button\", {\n    onClick: function onClick() {\n      return handleSubmit(\"Paymaya\");\n    },\n    className: \"btn btn-light mb-3\"\n  }, \"Confirm Order\") : __jsx(\"div\", {\n    className: \"lds-ring\"\n  }, __jsx(\"div\", null), __jsx(\"div\", null), __jsx(\"div\", null), __jsx(\"div\", null)), __jsx(\"hr\", null)) : null)))))));\n}\n\nexport default PaymentMethods;","map":null,"metadata":{},"sourceType":"module"}